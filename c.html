<!DOCTYPE html>
<html lang="zh-Hant">
<head>
<meta charset="UTF-8" />
<title>MAZE</title>

<style>
body {
    margin: 0;
    background: linear-gradient(180deg, #001f3f, #000000);
    height: 100vh;
    overflow: hidden;
    font-family: "Segoe UI","Helvetica Neue",Arial,sans-serif;
}
canvas {
    display: block;
    margin: 0 auto;
}
#startScreen {
    position: fixed;
    inset: 0;
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: center;
    gap: 30px;
    background: linear-gradient(180deg, #001f3f, #000000);
    z-index: 20;
    transition: transform 1s ease;
}
#startScreen.hide { transform: translateY(-100%); }

.title {
    font-size: 72px;
    font-weight: 300;
    letter-spacing: 6px;
    color: white;
}

.buttons { display: flex; gap: 16px; }
.buttons button {
    padding: 12px 28px;
    font-size: 18px;
    border-radius: 30px;
    border: 1px solid rgba(255,255,255,.4);
    background: transparent;
    color: white;
    cursor: pointer;
}

#success {
    position: fixed;
    top: 45%;
    left: 50%;
    transform: translate(-50%,-50%);
    font-size: 60px;
    color: white;
    opacity: 0;
    transition: opacity .6s;
    pointer-events: none;
}
#success.show { opacity: 1; }

#playAgain {
    position: fixed;
    top: 60%;
    left: 50%;
    transform: translate(-50%,-50%);
    padding: 14px 36px;
    font-size: 20px;
    border-radius: 30px;
    border: 1px solid rgba(255,255,255,.6);
    background: rgba(0,0,0,.4);
    color: white;
    cursor: pointer;
    opacity: 0;
    pointer-events: none;
    transition: opacity .4s, transform .3s;
}
#playAgain.show {
    opacity: 1;
    pointer-events: auto;
    transform: translate(-50%,-50%) scale(1.05);
}
</style>
</head>

<body>

<div id="startScreen">
    <div class="title">Maze</div>
    <div class="buttons">
        <button onclick="setDifficulty('easy')">EASY</button>
        <button onclick="setDifficulty('normal')">NORMAL</button>
        <button onclick="setDifficulty('hard')">HARD</button>
    </div>
</div>

<canvas id="mazeCanvas"></canvas>
<div id="success">SUCCESS</div>
<button id="playAgain">Play Again</button>

<script>
const canvas = document.getElementById("mazeCanvas");
const ctx = canvas.getContext("2d");

let COLS=30, ROWS=20, CELL=40;
let grid;

let player = { x:0, y:0, r:6 };
let moveSpeed = 4;
let lightRadius = 200;
let finish = { x:0, y:0 };

const successEl = document.getElementById("success");
const playAgainBtn = document.getElementById("playAgain");

function resizeCanvas(){
    canvas.width = window.innerWidth;
    canvas.height = window.innerHeight;
}
resizeCanvas();
window.addEventListener("resize", resizeCanvas);

function computeCellSize(){
    CELL = Math.floor(Math.min(canvas.width/COLS, canvas.height/ROWS));
}

function createGrid(){
    return Array.from({length:ROWS},(_,r)=>
        Array.from({length:COLS},(_,c)=>({
            r,c,visited:false,
            walls:{top:true,right:true,bottom:true,left:true}
        }))
    );
}

function generateMaze(){
    const stack=[];
    let cur=grid[0][0];
    cur.visited=true;

    while(true){
        const {r,c}=cur;
        const n=[];
        if(r>0&&!grid[r-1][c].visited) n.push(grid[r-1][c]);
        if(c<COLS-1&&!grid[r][c+1].visited) n.push(grid[r][c+1]);
        if(r<ROWS-1&&!grid[r+1][c].visited) n.push(grid[r+1][c]);
        if(c>0&&!grid[r][c-1].visited) n.push(grid[r][c-1]);

        if(n.length){
            const next=n[Math.random()*n.length|0];
            if(next.r===r-1){cur.walls.top=false;next.walls.bottom=false;}
            if(next.c===c+1){cur.walls.right=false;next.walls.left=false;}
            if(next.r===r+1){cur.walls.bottom=false;next.walls.top=false;}
            if(next.c===c-1){cur.walls.left=false;next.walls.right=false;}
            stack.push(cur);
            cur=next;
            cur.visited=true;
        } else if(stack.length) cur=stack.pop();
        else break;
    }
}

function drawMaze(ctx2){
    ctx2.strokeStyle="#fff";
    ctx2.lineWidth=3;
    for(let r=0;r<ROWS;r++)for(let c=0;c<COLS;c++){
        const cell=grid[r][c];
        const x=c*CELL,y=r*CELL;
        ctx2.beginPath();
        if(cell.walls.top) ctx2.moveTo(x,y),ctx2.lineTo(x+CELL,y);
        if(cell.walls.right) ctx2.moveTo(x+CELL,y),ctx2.lineTo(x+CELL,y+CELL);
        if(cell.walls.bottom) ctx2.moveTo(x,y+CELL),ctx2.lineTo(x+CELL,y+CELL);
        if(cell.walls.left) ctx2.moveTo(x,y),ctx2.lineTo(x,y+CELL);
        ctx2.stroke();
    }

    ctx2.fillStyle="red";
    ctx2.beginPath();
    ctx2.arc(finish.x,finish.y,player.r+2,0,Math.PI*2);
    ctx2.fill();
}

function drawLighting(){
    const off=document.createElement("canvas");
    off.width=canvas.width;
    off.height=canvas.height;
    const o=off.getContext("2d");

    drawMaze(o);

    const g=o.createRadialGradient(player.x,player.y,0,player.x,player.y,lightRadius);
    g.addColorStop(0,"rgba(255,255,255,1)");
    g.addColorStop(1,"rgba(255,255,255,0)");
    o.globalCompositeOperation="destination-in";
    o.fillStyle=g;
    o.fillRect(0,0,off.width,off.height);

    ctx.drawImage(off,0,0);

    ctx.fillStyle="white";
    ctx.beginPath();
    ctx.arc(player.x,player.y,player.r,0,Math.PI*2);
    ctx.fill();
}

function canMove(nx,ny){
    if(nx<player.r||ny<player.r||nx>COLS*CELL-player.r||ny>ROWS*CELL-player.r) return false;
    const cx=Math.floor(nx/CELL), cy=Math.floor(ny/CELL);
    const cell=grid[cy]?.[cx];
    if(!cell) return false;
    const r=player.r+1;
    if(cell.walls.right && nx+r>(cx+1)*CELL) return false;
    if(cell.walls.left && nx-r<cx*CELL) return false;
    if(cell.walls.bottom && ny+r>(cy+1)*CELL) return false;
    if(cell.walls.top && ny-r<cy*CELL) return false;
    return true;
}

window.addEventListener("keydown",e=>{
    let nx=player.x, ny=player.y;
    if(e.key==="ArrowLeft") nx-=moveSpeed;
    if(e.key==="ArrowRight") nx+=moveSpeed;
    if(e.key==="ArrowUp") ny-=moveSpeed;
    if(e.key==="ArrowDown") ny+=moveSpeed;
    if(canMove(nx,player.y)) player.x=nx;
    if(canMove(player.x,ny)) player.y=ny;
});

function checkGoal(){
    if(Math.hypot(player.x-finish.x,player.y-finish.y)<10){
        successEl.classList.add("show");
        playAgainBtn.classList.add("show");
    }
}

function rebuild(){
    computeCellSize();
    grid=createGrid();
    generateMaze();
    player.x=CELL/2;
    player.y=CELL/2;
    finish.x=(COLS-1)*CELL+CELL/2;
    finish.y=(ROWS-1)*CELL+CELL/2;
    successEl.classList.remove("show");
    playAgainBtn.classList.remove("show");
}

function setDifficulty(l){
    if(l==="easy"){COLS=18;ROWS=12;player.r=6;moveSpeed=4;}
    if(l==="normal"){COLS=30;ROWS=20;player.r=6;moveSpeed=4;}
    if(l==="hard"){COLS=45;ROWS=30;player.r=4;moveSpeed=3;}
    rebuild();
    document.getElementById("startScreen").classList.add("hide");
}

playAgainBtn.onclick=()=>{
    document.getElementById("startScreen").classList.remove("hide");
};

rebuild();

(function loop(){
    ctx.clearRect(0,0,canvas.width,canvas.height);
    drawLighting();
    checkGoal();
    requestAnimationFrame(loop);
})();
</script>
</body>
</html>
